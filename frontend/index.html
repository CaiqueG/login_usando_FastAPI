<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Login FastAPI</title>
</head>
<body>
  <h1>Login</h1>
  <form id="loginForm">
    <input type="text" placeholder="Usuário" name="username" required>
    <input type="password" placeholder="Senha" name="password" required>
    <button type="submit">Login</button>
  </form>

  <p>Ainda não tem conta? <a href="register.html">Cadastre-se aqui</a></p>

  <pre id="output"></pre>

  <script>
    const output = document.getElementById("output");

    async function login(event) {
      event.preventDefault();
      const form = event.target;
      const payload = {
        username: form.username.value,
        password: form.password.value
      };
      const res = await fetch("/login", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      output.textContent = JSON.stringify(data, null, 2);

      if (data.access_token) {
        document.cookie = `access_token=${data.access_token}; path=/; max-age=900`; // expira em 15 min
        alert("Login realizado com sucesso!");
        window.location.href = "profile.html"; // redireciona para o perfil
      } else {
        alert("Usuário ou senha inválidos!");
      }
    }

    document.getElementById("loginForm").addEventListener("submit", login);
  </script>
</body>
</html>
